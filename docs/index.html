
<!DOCTYPE html>
<html>
  <head>
    <title>Quality Assurance with Chai | freeCodeCamp.org</title>
    <link rel="shortcut icon" href="https://cdn.freecodecamp.org/universal/favicons/favicon-32x32.png" type="image/x-icon"/>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header>
      <h1>
        Automated Testing
      </h1>
    </header>
    <main>
      <script>
        function Utils() {
   this.ready = function (fn) {
      if (typeof fn !== 'function') {
         return;
      }

      if (document.readyState === 'complete') {
         return fn();
      }

      document.addEventListener('DOMContentLoaded', fn, false);
   };

   this.ajax = function (options, cb) {
      const xmlhttp = new XMLHttpRequest();

      xmlhttp.onreadystatechange = function () {
         if (xmlhttp.readyState === 4){
           if(Math.floor(xmlhttp.status/100) === 2) {
             var results = xmlhttp.responseText;
             var type = xmlhttp.getResponseHeader('Content-Type');
             if(type.match('application/json')) {
               results = JSON.parse(results);
             }
             cb(null, results);
           } else {
             cb(xmlhttp);
           }
         }
      };

      const method = options.method || 'get';
      let url = options.url || '/';

      if(url.charAt(url.length - 1) === '/')
        url = url.slice(0,url.length-1);

      if (options.data) {
        let query;
        let contentType = "application/x-www-form-urlencoded";
        if(options.type && options.type === 'json') {
          query = JSON.stringify(options.data);
          contentType = "application/json";
        } else {
          query = [];
          for (let key in params) {
            query.push(key + '=' + encodeURIComponent(params[key]));
            query.push('&');
          }
          query.pop();
          query = query.join('');
        }

        switch(method.toLowerCase()){
          case 'get':
            url += ('?' + query);
            xmlhttp.open(method, url, true);
            xmlhttp.send();
            break;
          case 'put':
          case 'patch':
          case 'delete':
          case 'post':
            xmlhttp.open(method, url, true);
            xmlhttp.setRequestHeader("Content-type", contentType);
            xmlhttp.send(query);
            break;
          default:
            return;
        }
      } else {
        xmlhttp.open(method, url, true);
        xmlhttp.send();
      }

   };
}

const utils = new Utils();

utils.ready(function() {

  const form = document.getElementById('f1');
  const input = document.getElementById('i1');
  const div = document.getElementById('tn');
  form.addEventListener('submit', function(e){
    e.preventDefault();
    if(input.value) {
      const options = {
        method: 'put',
        url: '/travellers',
        type: 'json',
        data: {surname: input.value}
      };
      div.innerHTML = '<p>Loading...</p>';
      utils.ajax(options, function(err, res) {
        if(err) return console.log(err);
        div.innerHTML = '<p>first name: <span id="name">' + res.name + '</span><p>' +
          '<p>last name: <span id="surname">' + res.surname + '</span><p>' +
          '<p>dates: <span id="dates">' + res.dates + '</span><p>';
      });
    }
  });
});
</script>
      <h2>Functional Tests Example</h2>
      <div class="pane">
        <h4>Famous Italian Explorers</h4>
        <form action="/travellers" method="POST" id="f1">
          <label for="i1">surname: </label>
          <input id="i1" type="text" name="surname" placeholder="try with 'Polo'...">
          <button type="submit">submit</button>
        </form>
        <div id="tn"></div>
      </div>
      <div class="pane">
        <p class="specs">
          Input form HTML:<br>
          ----------------<br>
          &lt;input type="text" name="surname"&gt;<br>
          &lt;button type="submit"&gt;submit&lt;/button&gt;<br>
          <br>
          Results div HTML (after Ajax):<br>
          ------------------------------<br>
          &lt;p&gt;first name:&lt;span id="name"&gt;[name]&lt;/span&gt;&lt;/p&gt;<br>
          &lt;p&gt;last name:&lt;span id="surname"&gt;[surname]&lt;/span&gt;&lt;/p&gt;<br>
          &lt;p&gt;dates:&lt;span id="dates"&gt;[birth - death]&lt;/span&gt;&lt;/p&gt;<br>
        </p>
      </div>
    </main>
    <!--<script src='/test.github.io/client.js'></script>-->
  </body>
</html>
